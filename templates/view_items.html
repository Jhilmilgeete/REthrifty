{% extends "base.html" %}

{% block content %}
    <div class="view-items-container">
        <h2>Items For Sale</h2>

        {# Add the search/filter form here #}
        <div class="search-filter-form">
            <form action="{{ url_for('view') }}" method="GET">
                <label for="item-category">Category:</label>
                <select id="item-category" name="item-category">
                    <option value="">All Categories</option>
                    <option value="Books" {% if selected_category == 'Books' %}selected{% endif %}>Books</option>
                    <option value="Clothes" {% if selected_category == 'Clothes' %}selected{% endif %}>Clothes</option>
                    <option value="Household Items" {% if selected_category == 'Household Items' %}selected{% endif %}>Household Items</option>
                    <option value="Accessories" {% if selected_category == 'Accessories' %}selected{% endif %}>Accessories</option>
                </select>

                <label for="location">Location:</label>
                <input type="text" id="location" name="location" value="{{ selected_location }}">

                <button type="submit">Search</button>
            </form>
        </div>

        {# Display "No items found" message if items list is empty #}
        {% if not items %}
            <p>No items found matching your criteria.</p>
        {% endif %}

        <div class="items-grid">
            {% for item in items %}
            <div class="item-card">
                {# --- MODIFIED IMAGE LOGIC --- #}
                {# Determine the correct image path #}
                {% set image_to_display = 'images/' + item.image_filename if item.image_filename else ('images/clothes_placeholder.png' if item.category == 'Clothes' else 'images/placeholder.png') %}
                {# Display the image #}
                <img src="{{ url_for('static', filename=image_to_display) }}" alt="{{ item.name }}">
                {# --- END MODIFIED IMAGE LOGIC --- #}

                <h3>{{ item.name }}</h3>
                <p>Category: {{ item.category }}</p>
                <p>Price: {{ item.price }}</p>
                <p>Location: {{ item.location }}</p>
                <a href="{{ url_for('item_details', item_id=item.id) }}">View Details</a>
            </div>
            {% endfor %}
        </div>
    </div>
{% endblock %}

{% block extra_css %}
<style>
    .view-items-container {
        max-width: 1000px;
        margin: 2rem auto;
        padding: 20px;
        background-color: #f9f9f9;
        border-radius: 8px;
    }

    .search-filter-form {
        margin-bottom: 20px;
        padding: 15px;
        background-color: #fff;
        border-radius: 6px;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
    }

    .search-filter-form label {
        display: block;
        margin-bottom: 5px;
        font-weight: bold;
    }

    .search-filter-form input[type="text"],
    .search-filter-form select {
        width: 100%;
        padding: 8px;
        margin-bottom: 10px;
        border: 1px solid #ddd;
        border-radius: 4px;
    }

    .search-filter-form button {
        padding: 8px 15px;
        background-color: #5cb85c;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
    }

    .items-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
    }

    .item-card {
        background-color: #fff;
        border-radius: 8px;
        padding: 15px;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
    }

    .item-card img {
        width: 100%;
        height: 200px;
        object-fit: cover;
        border-radius: 6px;
        margin-bottom: 10px;
    }

    .item-card h3 {
        margin-top: 0;
        margin-bottom: 10px;
    }
</style>
{% endblock %}
